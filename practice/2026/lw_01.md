# Лабораторная работа 1. Основы SQL и манипуляция данными

## Цель работы
Научиться писать запросы `SELECT` для аналитики и выполнять `CRUD` операции в локальной базе данных PostgreSQL.

*   **Теория:** Глава 2 "The Basics of SQL for Analytics".
*   **Данные:** `bi_sql_data_student_dump.sql`.

---

## ⚠️ Важно: Разделение сред выполнения

| Тип задания | Среда выполнения | Примечание |
| :--- | :--- | :--- |
| **Задания 1, 2 (SELECT)** | **Основной сервер** | Выдается преподавателем. Права только на чтение. |
| **Задания со звездочкой * (CRUD)** | **Локально** | Необходимо развернуть свою БД или использовать [VM (devops_dba_25.ova)](https://envlab.ru/mod/url/view.php?id=303). |

---

## Часть 1. Общие задания (Guided Labs)

### 1.1. Персонал (Salespeople)
*Выполнить на основном сервере.*
1.  Вывести `username` первых 10 нанятых женщин-продавцов (`gender='Female'`).
2.  Сортировка по `hire_date`.
3.  Повторить для мужчин.

### 1.2. Клиенты (Customers)
*Выполнить на основном сервере.*
1.  Все `email` клиентов из 'FL', сортировка по алфавиту.
2.  Имена и email клиентов из 'New York City', 'NY'. Сортировка: Фамилия, затем Имя.
3.  Все клиенты с телефоном, сортировка по дате регистрации.

### 1.3*. Спецпроект (CRUD)
*Выполнить локально.*
1.  `CREATE TABLE customers_nyc AS ...` (копия клиентов из NYC).
2.  `DELETE` клиентов с индексом `10014`.
3.  `ALTER TABLE ... ADD COLUMN event text;`
4.  `UPDATE ... SET event = 'thank-you party';`

---

## Часть 2. Индивидуальные задания



| # | Задание 1 (SELECT) | Задание 2 (Логика) | Задание 3* (CRUD - Локально) |
|---|---|---|---|
| **1** | `products` ('scooter') > $500. Сорт: цена DESC. | `sales` ('internet') 15k-30k. | `high_price` (товары > 1000). Цена * 1.1. Удалить < 2012 г. |
| **2** | `dealerships` ('TX') открыты > 2015. | `customers` без суффикса, с телефоном. | `inactive_cust` (из 'CA'). Статус = 'check'. Удалить zip '90%'. |
| **3** | `salespeople` (наняты 2018). Сорт: Фамилия. | `emails` (открыты, без клика). | `sales_2010` (за 2010). Канал = 'legacy'. Удалить сумма=0. |
| **4** | `products` ('Model Chi'). Сорт: год. | `customers` ('NY'/'NJ') за 2019. | `scooters_upd` ('scooter'). Цена - 50. Удалить 'Lemon'. |
| **5** | `salespeople` (мужчины). Сорт: дата увольнения. | `products` (год НЕ 2014-2016). | `fl_cust` ('FL'). Регион = 'South'. Удалить без email. |
| **6** | Топ-20 `sales` по сумме. | `dealerships` (закрытые) в 'CA'. | `recents` (продавцы > 2019). Титул='Jun'. Удалить уволенных. |
| **7** | `customers` (имя 'David'). Сорт: Фамилия. | `emails` (март-май 2015). | `autos` ('automobile'). Цена * 1.05. Удалить год < 2000. |
| **8** | `products` < $100. Сорт: цена ASC. | `salespeople` ('Manager'/'Director'). | `tx_dealers` ('TX'). Поле `active`='Y'. Удалить закрытые. |
| **9** | `sales` (dealership_id=15). Сорт: дата. | `customers` (email '@gmail.com'). | `leads` (клиенты 2020). Источник='Web'. Удалить 'Miami'. |
| **10** | `dealerships` (latitude > 40). | `products` ('automobile') < 15k. | `cheap_parts` (< 50). Цена * 2. Удалить 'accessory'. |
| **11** | 10 последних `emails`. | `sales` (канал != 'dealership'). | `ny_sales` (id 15). Сумма * 0.9. Удалить 2010 год. |
| **12** | `customers` (Female, 'WA'). | `salespeople` (Фамилия на 'S'). | `prospects` (без тел). Note='Call'. Удалить из 'NY'. |
| **13** | `products` (2019). Сорт: модель. | `dealerships` (Houston/Dallas/Austin).| `old_stock` (< 2010). Скидка=0.5. Удалить цену > 20k. |
| **14** | `sales` (Янв 2018). Сорт: сумма. | `customers` (ip '192.%'). | `female_staff`. Титул='Ms.'. Удалить нанятых < 2015. |
| **15** | `dealerships` (работающие). | `emails` (тема 'Save'/'Sale'). | `vip_clients` (> 50k). Статус='Gold'. Удалить 'phone'. |
| **16** | `salespeople` ('William'). Сорт: найм. | `products` (цена 1000-2000). | `west_dealers` (WA/OR/CA). Zone='West'. Удалить закр < 2018. |
| **17** | `customers` ('Chicago'). Сорт: индекс. | `sales` (dealership_id IS NULL). | `emails_click` (с кликом). Score=10. Удалить < 2012. |
| **18** | `products` ('scooter', 2015). | `customers` (latitude < 30). | `inventory_2018`. Цена + 100. Удалить дешевле 300. |
| **19** | `sales` (2021). Сорт: дата. | `dealerships` (НЕ 'CA' и НЕ 'TX'). | `managers` (менеджеры). ID + 1. Удалить найм < 2010. |
| **20** | `customers` (M, есть суффикс). | `salespeople` (активные). | `local_cust`. Flag=1. Удалить дубли по id. |
| **21** | `products` > 30k. Сорт: цена DESC. | `emails` (bounced='t'). | `failed_emails`. Retry='N'. Удалить тему 'Welcome'. |
| **22** | `dealerships` (zip '9%'). | `sales` (сумма = 0). | `prizes` (цена=0). Цена=1. Удалить модель 'Test'. |
| **23** | `salespeople` ('Johnson'). | `customers` (Зима). | `winter_sales`. Season='Winter'. Удалить < 100. |
| **24** | `customers` ('NV'). Сорт: город. | `products` (модель like '%2000%'). | `nv_clients`. Tax=0. Удалить (адрес IS NULL). |
| **25** | `emails` ('Welcome%'). Сорт: дата. | `salespeople` (уволены 2019). | `terminated`. Reason='Unknown'. Удалить уволены 2010. |
| **26** | `sales` ('phone'). Сорт: сумма. | `dealerships` (работали < 1 года). | `phones_sales`. Channel='Voice'. Удалить сумма < 10. |
| **27** | `products` (год != 2019). | `customers` (lat IS NULL). | `geo_missing`. Check='Manual'. Удалить (email IS NULL). |
| **28** | `dealerships` ('FL'). | `sales` (10k - 12k). | `mid_range` (500-1000). Цена * 0.9. Удалить 2013 г. |
| **29** | Первые 5 `customers`. | `salespeople` (F, имя на 'A'). | `a_team`. Group='Alpha'. Удалить найм 2020. |
| **30** | `products` (цена 0 или NULL). | `emails` (2011, не открыты). | `spam_list`. Тема='Last Chance'. Удалить старше 2010. |

## Критерии оценки
1.  **3 балла:** Задания SELECT выполнены верно.
2.  **4 балла:** SELECT верно + попытка выполнить CRUD.
3.  **5 баллов:** Полный комплект (SELECT на сервере + CRUD локально) с отчетом.