# Лабораторная работа 2. Многотабличные запросы и подготовка данных

## Цель работы
Освоить методы объединения таблиц (`JOIN`, `UNION`), работу с подзапросами и функции преобразования данных (`CASE`, `COALESCE`) в PostgreSQL.

**Основано на:**
*   Chapter 3. SQL for Data Preparation


---

## Часть 1. Общие задания (Guided Labs)

Выполните эти задания для тренировки. Код и скриншоты добавьте в отчет.

### Задание 2.1. Поиск покупателей авто (INNER JOIN)
**Бизнес-задача.** Получить контактные данные всех клиентов, купивших автомобиль, для обзвона.
**Требование:**
*   Использовать таблицу `sales`, `customers`, `products`.
*   Условие: `product_type` = 'automobile'.
*   Условие: `phone` is not null.
*   Вывести: `customer_id`, `first_name`, `last_name`, `phone`.

### Задание 2.2. Вечеринка в Лос-Анджелесе (UNION)
**Бизнес-задача.** Составить список приглашенных на мероприятие. Это клиенты И сотрудники из Лос-Анджелеса.
**Требование:**
*   Запрос 1: Клиенты из `city` = 'Los Angeles'.
*   Запрос 2: Продавцы (`salespeople`), работающие в дилерских центрах (`dealerships`) в `city` = 'Los Angeles'.
*   Объединить через `UNION`.
*   Добавить поле `guest_type` ('Customer' или 'Employee').

### Задание 2.3. Создание витрины данных (Data Transformation)
**Бизнес-задача.** Подготовить "плоскую" таблицу для аналитиков данных.
**Требование:**
1.  Соединить `sales` (основа), `customers`, `products`, `dealerships` (Left Join).
2.  Очистить данные:
    *   Если `dealership_id` в продажах NULL, заменить на -1 (используйте `COALESCE`).
3.  Создать признак (Feature Engineering):
    *   Столбец `high_savings`: равен 1, если (`base_msrp` - `sales_amount`) > 500. Иначе 0.

---

## Часть 2. Индивидуальные задания

[Варианты заданий на образовательном портале](https://envlab.ru/mod/assign/view.php?id=1046)

---

## Требования к отчету

1.  Создайте файл `README.md` в папке `lab_02`.
2.  Вставьте условие задач вашего варианта.
3.  Вставьте SQL код решения.
4.  Вставьте скриншот результата (таблицы).

5.  Загрузите файл `lab_02.sql` с кодом.
