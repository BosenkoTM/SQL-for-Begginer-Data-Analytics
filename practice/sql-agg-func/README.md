
# Самостоятельная работа 1. Агрегатные функции

## Introduction

В этой самостоятельной работе `1` необходимо запрашивать данные из таблицы, которая заполнена статистикой достижений [`Бэйба Рута`](https://ru.wikipedia.org/wiki/%D0%A0%D1%83%D1%82,_%D0%91%D0%B5%D0%B9%D0%B1) за карьеру. Использовать `агрегатные` функции для извлечения информации из таблицы, которую не могут отследить базовые запросы. 

## Objectives

1. Создать таблицу `babe_ruth_stats` в [PostgreSQL `14.7`](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads). 
2. Напишите запросы с `агрегатными` функциями, такими как `COUNT`, `MAX`, `MIN` и `SUM`.
3. Создайте псевдоним для возвращаемого значения `агрегатной` функции.
4. Используйте `GROUP BY` для сортировки наборов данных, возвращаемых агрегатными функциями.
5. Сравните `агрегаты`, используя предложение `HAVING`.

## Babe Ruth -- Career Hitting Statistics


Запросы выполнять из таблицы `babe_ruth_stats`, представленной ниже или скачать [тут](/practice/sql-agg-func/babe_ruth_stats.csv).

year|team |league|doubles|triples|hits|HR|games|runs|RBI|at_bats|BB |SB|SO|AVG
----|-----|------|-------|-------|----|--|-----|----|---|-------|---|--|--|------
1914|"BOS"|"AL"  |1      |0      |2   |0 |5    |1   |2  |10     |0  |0 |4 |0.2
1915|"BOS"|"AL"  |10     |1      |29  |4 |42   |16  |21 |92     |9  |0 |23|0.315
1916|"BOS"|"AL"  |5      |3      |37  |3 |67   |18  |15 |136    |10 |0 |23|0.272
1917|"BOS"|"AL"  |6      |3      |40  |2 |52   |14  |12 |123    |12 |0 |18|0.325
1918|"BOS"|"AL"  |26     |11     |95  |11|95   |50  |66 |317    |58 |6 |58|0.3
1919|"BOS"|"AL"  |34     |12     |139 |29|130  |103 |114|432    |101|7 |58|0.322
1920|"NY" |"AL"  |36     |9      |172 |54|142  |158 |137|458    |150|14|80|0.376
1921|"NY" |"AL"  |44     |16     |204 |59|152  |177 |171|540    |145|17|81|0.378
1922|"NY" |"AL"  |24     |8      |128 |35|110  |94  |99 |406    |84 |2 |80|0.315
1923|"NY" |"AL"  |45     |13     |205 |41|152  |151 |131|522    |170|17|93|0.393
1924|"NY" |"AL"  |39     |7      |200 |46|153  |143 |121|529    |142|9 |81|0.378
1925|"NY" |"AL"  |12     |2      |104 |25|98   |61  |66 |359    |59 |2 |68|0.29
1926|"NY" |"AL"  |30     |5      |184 |47|152  |139 |146|495    |144|11|76|0.372
1927|"NY" |"AL"  |29     |8      |192 |60|151  |158 |164|540    |137|7 |89|0.356
1928|"NY" |"AL"  |29     |8      |173 |54|154  |163 |142|536    |137|4 |87|0.323
1929|"NY" |"AL"  |26     |6      |172 |46|135  |121 |154|499    |72 |5 |60|0.345
1930|"NY" |"AL"  |28     |9      |186 |49|145  |150 |153|518    |136|10|61|0.359
1931|"NY" |"AL"  |31     |3      |199 |46|145  |149 |163|534    |128|5 |51|0.373
1932|"NY" |"AL"  |13     |5      |156 |41|133  |120 |137|457    |130|2 |62|0.341
1933|"NY" |"AL"  |21     |3      |138 |34|137  |97  |103|459    |114|4 |90|0.301
1934|"NY" |"AL"  |17     |4      |105 |22|125  |78  |84 |365    |104|1 |63|0.288
1935|"BOS"|"NL"  |0      |0      |13  |6 |28   |13  |12 |72     |20 |0 |24|0.181

**Хоум-ран** (англ. `Home run`, `HR`) — разновидность игровой ситуации в бейсболе, представляющая собой хит, во время которого отбивающий и бегущие, находящиеся на базах, успевают совершить полный круг по базам и попасть в дом (то есть совершить пробежку), при этом не имеется ошибок со стороны защищающейся команды. В современном бейсболе хоум-ран обычно достигается сильным и точным ударом отбивающего, в результате которого мяч, не попадая в фол-зону, покидает границы аутфилда без касания земли — так называемый автоматический хоум-ран.


## Queries

#### `Q1` - total_seasons
Подсчитать общее количество лет, в течение которых Бэйб Рут играл в профессиональный бейсбол.

#### `Q2` - total_seasons_with_ny
Подсчитать общее количество `year`, сыгранных за `NY` Yankees.

#### `Q3` - most_hr
Выбрать наибольшее количество `HR`, которое Бэйб Рут набрал за один сезон.

#### `Q4` - least_hr
Выбрать наименьшее количество попаданий `HR` за один сезон.

#### `Q5` - total_hr
Вернуть общее количество `HR`, которые Бэйб Рут нанес за свою карьеру.

#### `Q6` - average_hr_per_year
Получить среднее количество попаданий в `HR` за указанный год.

#### `Q7` - year_and_games_with_least_hr
В предыдущем запросе узнали, что Бэйб Рут достиг 0 `HR` за один год. Эта статистика могла бы не отражать типичный сезон Бэйба Рута, если бы он сыграл всего несколько игр в том году. Давайте подсчитаем, сколько игр он сыграл в том сезоне. Выбрать `year`и and `games` из сезона, в котором Рут набрала 0 `HR`.

#### `Q8` - select_yr_and_min_hr_with_at_least_100_games
Мы определили, что Бэйб Рут сделал 0 хоумранов в свой первый год, когда он сыграл всего пять игр. Давайте избежим выбросов, взглянув на годы, когда Рут сыграла не менее 100 игр. Выбрать `year` с наименьшим количеством `HR` только из тех сезонов, в которых было сыграно более 100 `games`.

#### `Q9` - avg_batting_avg_aliased_as_career_average
Выбрать среднее значение `AVG` средних показателей Рут. Заголовок результата будет «AVG(AVG)», что довольно запутанно, поэтому укажите псевдоним «career_average».


#### `Q10` - total_years_and_hits_per_team
Выбрать `team` и общее количество `year` и `hits`, но представьте результаты для каждой команды. (**Подсказка**: вам нужно будет отсортировать результат с помощью определенного предложения...)

#### `Q11` - total_years_and_hr_per_team_ordered_by_hr
Предыдущий запрос сначала возвращает статистику Бэйба Рута по Бостону. Тем не менее, подавляющая часть статистики карьеры Рута пришлась на время, когда он играл за `NY` Yankee. Разве мы не должны сначала пересмотреть статистику Рут по `NY`? Снова напишите предыдущий запрос, но на этот раз нам нужны общие `HR` Бейба Рута, а не его общие `hits`. Убедитесь, что в результирующем наборе данных сначала указана статистика Бейба Рута как янки.
> **Совет**: вам нужно будет добавить еще одно предложение сортировки после `GROUP BY`.

#### `Q12` - years_with_on_base_over_300
Мы хотим знать годы, в которые Рут успешно достиг базы более 300 раз. Нам нужно добавить `hits` и `BB`, чтобы вычислить, сколько раз Рут достиг базы. Просто сложите два столбца вместе (например: `SELECT hits + BB FROM...`) и присвойте этому значению псевдоним `on_base`. Выберите `year` и `on_base` только для тех лет, для которых `on_base` превышает 300.
> **Подсказка**: `WHERE` здесь не работает!

