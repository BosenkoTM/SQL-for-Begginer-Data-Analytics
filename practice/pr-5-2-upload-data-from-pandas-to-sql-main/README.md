# Практическая работа 8. Анализ метода загрузки данных

## Цель:
Определить наиболее эффективный метод загрузки данных (малых и больших объемов) из CSV-файлов в СУБД PostgreSQL, сравнивая время выполнения для методов: pandas.to_sql(), psycopg2.copy_expert() (с файлом и с io.StringIO), и пакетная вставка (psycopg2.extras.execute_values).

## Задачи:

1.  **Подключиться** к предоставленной базе данных PostgreSQL.
2.  **Проанализировать структуру** исходных CSV-файлов ([upload_test_data.csv](https://github.com/BosenkoTM/SQL-for-Begginer-Data-Analytics/blob/main/practice/pr-5-2-upload-data-from-pandas-to-sql-main/upload_test_data.csv) , [upload_test_data_big.csv](https://github.com/BosenkoTM/SQL-for-Begginer-Data-Analytics/blob/main/practice/pr-5-2-upload-data-from-pandas-to-sql-main/upload_test_data_big.csv)).
3.  **Создать эскизы ER-диаграмм** для таблиц, соответствующих структуре CSV-файлов.
4.  **Реализовать** три различных метода загрузки данных в PostgreSQL(**pandas.to_sql()**, **copy_expert()**, **io.StringIO**).
5.  **Измерить время**, затраченное каждым методом на загрузку данных из малого файла (`upload_test_data.csv`).
6.  **Измерить время**, затраченное каждым методом на загрузку данных из большого файла (`upload_test_data_big.csv`).
7.  **Визуализировать** результаты сравнения времени загрузки с помощью гистограммы (`matplotlib`).
8.  **Сделать выводы** об эффективности каждого метода для разных объемов данных.


Результаты представить в виде отдельного файла ERD-диаграммы для простых и больших данных из PostgreSQL с расширением `FIO_ERD_test_data.jpg`, `FIO_ERD_test_data_big.jpg`;
Ссылку на дашборд в `Yandex DataLens` или файл с расширением `.ipynb`.

## Индивидуальные задания.

| Вариант | Задание 1: Настройка таблиц | Задание 2: Загрузка малых данных (`sales_small`) | Задание 3: Загрузка больших данных (`sales_big`) | Задание 4: SQL Анализ | Задание 5: Python/Colab Анализ и Визуализация |
| :------ | :-------------------------- | :----------------------------------------------- | :------------------------------------------------ | :-------------------- | :---------------------------------------------- |
| **1**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Подсчитать среднюю стоимость (`cost`) в `sales_small`. | Python: Построить гистограмму распределения `quantity` из `sales_small`. |
| **2**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Найти максимальную `total_revenue` в `sales_big`. | Python: Построить диаграмму рассеяния `cost` vs `quantity` из `sales_small`. |
| **3**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Подсчитать записи в `sales_big`, где `cost` < 1.00. | Python: Рассчитать основные статистики (`describe()`) для `total_revenue` из `sales_big` (LIMIT 50000). |
| **4**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Вычислить суммарное `quantity` в `sales_small`, где `cost` > 5.00. | Python: Построить столбчатую диаграмму топ-5 `total_revenue` из `sales_small`. |
| **5**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Найти минимальную `cost` в `sales_big`. | Python: Построить ящик с усами (boxplot) для `cost` из `sales_big` (LIMIT 50000). |
| **6**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Выбрать записи из `sales_small`, где `quantity` BETWEEN 45 AND 50. | Python: Загрузить `small_csv_path` в DataFrame, рассчитать корреляцию `quantity` и `total_revenue`. |
| **7**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Выбрать `id`, `total_revenue` для 10 записей с макс. выручкой из `sales_big`. | Python: Извлечь результаты SQL (задание 4) в DataFrame и вывести его. |
| **8**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Подсчитать записи в `sales_small`, где `total_revenue` > 200. | Python: Построить гистограмму `quantity` из `sales_big` (LIMIT 50000). |
| **9**   | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Вычислить средний `cost` в `sales_big`, где `quantity` = 50. | Python: Загрузить `big_csv_path` (если возможно), рассчитать медианный `cost`. Сравнить со средним из SQL. |
| **10**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Найти `id` из `sales_small`, где `total_revenue` < 0.1. | Python: Извлечь 100 случайных записей из `sales_big`, построить scatter plot `quantity` vs `cost`. |
| **11**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Рассчитать общую сумму `total_revenue` в `sales_big`. | Python: В DataFrame `sales_small` добавить колонку `revenue_check = quantity * cost`, сравнить с `total_revenue`. |
| **12**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Выбрать первые 15 записей из `sales_big`, отсортированных по `cost` (ASC). | Python: Построить ящик с усами (boxplot) для `total_revenue` из `sales_small`. |
| **13**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Подсчитать количество уникальных `quantity` в `sales_small`. | Python: Извлечь данные из `sales_big` (LIMIT 50000), рассчитать 25-й и 75-й перцентили `cost`. |
| **14**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Выбрать `id`, `cost` для 5 записей с самой низкой `cost` (>0) в `sales_big`. | Python: Построить гистограмму `cost` из `sales_small`. |
| **15**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Вычислить суммарную `total_revenue` в `sales_small`, где `quantity` < 10. | Python: Рассчитать корреляцию `cost` и `total_revenue` в DataFrame `sales_small`. |
| **16**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Найти среднее `quantity` в `sales_big`, где `total_revenue` > 400. | Python: Построить scatter plot `quantity` vs `total_revenue` из `sales_big` (LIMIT 5000). |
| **17**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Подсчитать записи в `sales_small`, где `cost` = 0.50. | Python: Рассчитать стандартное отклонение `quantity` из `sales_big` (LIMIT 50000). |
| **18**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Выбрать `id` записей из `sales_big` с максимальным `quantity`. | Python: Построить гистограмму `total_revenue` из `sales_big` (LIMIT 50000). |
| **19**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Рассчитать суммарное `quantity` в `sales_small`, где `cost` < AVG(`cost`). (С подзапросом). | Python: Рассчитать матрицу корреляций (`cost`, `quantity`, `total_revenue`) для `sales_small`. |
| **20**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Найти топ-5 самых частых `quantity` и их количество в `sales_big`. | Python: Построить столбчатую диаграмму для результатов SQL (задание 4). |
| **21**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Вычислить % записей в `sales_small`, где `total_revenue` > 100. | Python: Рассчитать медианное значение `cost` из DataFrame `sales_small`. |
| **22**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Найти `id` записей в `sales_big`, где `cost` равен минимальному `cost` (>0) в таблице. | Python: Построить ящик с усами (boxplot) для `quantity` из `sales_small`. |
| **23**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Рассчитать среднюю `total_revenue` в `sales_big`, где `quantity` BETWEEN 10 AND 20. | Python: Рассчитать стандартное отклонение `total_revenue` из `sales_big` (LIMIT 50000). |
| **24**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Подсчитать записи в `sales_small`, где `cost` > 9.50. | Python: Построить scatter plot `cost` vs `total_revenue` из `sales_small`. |
| **25**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Выбрать топ-10 записей из `sales_big` по убыванию `quantity`. | Python: Рассчитать `.describe()` для `quantity` в DataFrame `sales_small`. |
| **26**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Найти максимальный `cost` в `sales_small`, где `quantity` = 1. | Python: Построить гистограмму `cost` из `sales_big` (LIMIT 50000) с 20 бинами. |
| **27**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Рассчитать суммарную `total_revenue` в `sales_big`, где `cost` BETWEEN 2.00 AND 3.00. | Python: Найти строки в DataFrame `sales_small`, где `abs(quantity * cost - total_revenue) > 0.01`. |
| **28**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `pandas.to_sql()`                       | Метод: `copy_expert (file)`                       | SQL: Подсчитать записи в `sales_big`, где `quantity` > AVG(`quantity`). (С подзапросом). | Python: Построить гистограмму `total_revenue` из `sales_small`. |
| **29**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (file)`                    | Метод: `copy_expert (file)`                       | SQL: Найти 5 самых редких значений `cost` в `sales_small`. | Python: Рассчитать медианное значение `quantity` из `sales_big` (LIMIT 50000). |
| **30**  | Создать таблицы `sales_small`, `sales_big`. | Метод: `copy_expert (StringIO)`                | Метод: `copy_expert (file)`                       | SQL: Выбрать `id`, `total_revenue` из `sales_small`, ORDER BY `total_revenue` ASC, OFFSET 10 LIMIT 20. | Python: Построить scatter plot `quantity` vs `cost` из `sales_big` (LIMIT 5000), раскрасив точки (cost > 5). |
