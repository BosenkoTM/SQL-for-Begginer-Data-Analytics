# SQL-for-Begginer & Data Analytics

# Lecturer
Timur Bosenko M. (bosenkotm@mgpu.ru)

–ó–¥–µ—Å—å –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ **`–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å –ø–æ–º–æ—â—å—é SQL`**. 

–£—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ–∑–≤–æ–ª–∏—Ç –ø–æ–ª—É—á–∏—Ç—å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –≤ SQL, –≤–∫–ª—é—á–∞—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã, –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.  –í—ã —É–∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ SQL —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ –ø–æ–ª—É—á–∞—Ç—å —Ü–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –í—ã —Å–º–æ–∂–µ—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –≤–∑–≥–ª—è–¥–æ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞.
–í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞ –±—É–¥—É—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –Ω–∞—á–Ω–µ–º –≤–º–µ—Å—Ç–µ –∏ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω—ã –∫ —Å–ª–µ–¥—É—é—â–µ–π –≤—Å—Ç—Ä–µ—á–µ. 

## –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ 

[PostgreSQL **`16.0  –∏–ª–∏ –≤—ã—à–µ`** –¥–ª—è Windows&Mac_OS_X&Linux](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads)

[–°–µ—Ä–≤–∏—Å `SQLizer`, –∫–æ–Ω–≤–µ—Ä—Ç `csv` –≤ `DDL`(—Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º VPN)](https://sqlizer.io/#/)

[One Compiler](https://onecompiler.com/postgresql/)

[SQLFLOW](https://sqlflow.gudusoft.com/#/)

[–£—Å—Ç–∞–Ω–æ–≤–∫–æ–π Anaconda Distribution](https://docs.anaconda.com/free/anaconda/install/)

[–î–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ Anaconda Windows](https://disk.yandex.ru/d/q5OBwcdGzv6Kig).


## –¢–µ–∫—É—â–∞—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å

 [–ê–ë–ü](https://lms.mgpu.ru/editor/course/2320)

## –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å –ø–æ–º–æ—â—å—é SQL

- `lecture 01`:
    -  [Intro]()

- `lecture 02`:
    -  [–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å –ø–æ–º–æ—â—å—é SQL]()

- `lecture 03`:
    -  [–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö]()

- `lecture 04`:
    -  [–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö](/lectures/lecture_04.pdf)

- `lecture 05`:
    -  [SQL –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö]()
  
- `lecture 06`:
    -  [–ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö. –ß–∞—Å—Ç—å 1](/lectures/l_06.pdf).
    -  [sqlalchemy_data_from_pandas_to_postgres](https://colab.research.google.com/drive/1HLrOzlobYiHIISh_7PCjWfI7QmDPt_dM?usp=sharing).
    -  [–ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö. –ß–∞—Å—Ç—å 2](/lectures/l_06_2.pdf).
    -  [–ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö. –ß–∞—Å—Ç—å 3](/lectures/l_06_3.pdf).
    -  [–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∫ –ª–µ–∫—Ü–∏–∏ 6-7](/practice/conda_help_for_lesson).

- `lecture 07`:
    -  [–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö]()
    -  [–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ PostgreSQL](https://github.com/BosenkoTM/Materialized-View-Strategies-In-PostgreSQL/blob/main/README.md)

- `lecture 08`:
    -  [–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π SQL]()
    -  –ü—Ä–∞–∫—Ç–∏–∫–∞ –Ω–∞ –ª–µ–∫—Ü–∏–∏ 1. [–•–æ–¥ —Ä–∞–±–æ—Ç—ã](https://github.com/BosenkoTM/SQL-for-Begginer-Data-Analytics/blob/main/practice/pr_on_lecture_plan_query.pdf)
    -  [BD_smalljoins](/practice/BD_smalljoins.sql)
 
-  `lecture 09`:
    -  [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤: —Å–æ–≤–µ—Ç—ã –∏ –º–µ—Ç–æ–¥—ã]()
    -  [–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ sql]()

- `lecture 10-11`:
    -  [–§—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã]() 
    -  [BD_smalljoins](/practice/BD_smalljoins.sql) 
    -  [Function.sql](/Datasets/Functions.sql)
           
- `lecture 12`:
    -  [Case Study]()

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã
    
   1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `Postgres` [**16.0+**](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads).
   2. –ó–∞–≥—Ä—É–∑–∏—Ç—å [data.dump](https://disk.yandex.ru/d/p3ga3WZpmAw8-Q)  –∏–ª–∏ [bi_sql_data_student_dump.sql](https://disk.yandex.ru/d/yJTa_s86xpbpMQ)  –≤ `Postgres`.
      –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î (–ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ —Å –¥–∞–º–ø–æ–º –ë–î):

      ```
      pg_restore -U  postgres -d –ò–ú–Ø_–ë–î_–í_POSTGRESQL bi_sql_data_student_dump.sql
      ```

      –µ—Å–ª–∏ `postgre SQL 16` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `devops_dba_25.ova` 

      ```
      cat data.dump | docker exec -i -e PGPASSWORD=your_pass postgres16 psql -U postgres -d your_db -h 172.18.0.3
      ```
      
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 1. [–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ SELECT](/practice/pr-1.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 2. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Joins](/practice/pr-2.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 3. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö](/practice/pr-03.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 4. [–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö](/practice/pr-04.pdf).
    - [–†–µ—à–µ–Ω–∏–µ –∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ 4](/solutions/solution_04.sql).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 5.  [SQL –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö](/practice/pr-5.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 6.  [SQL –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö](/practice/pr-6-2024.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 7.  [–†–∞–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏](practice/pr_07/readme.md).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 8.  [–ê–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–¥–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. pandas.to_sql() –∏ PostgreSQL COPY](/practice/pr-5-2-upload-data-from-pandas-to-sql-main).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 9.  [–ì–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö](/practice/pr-09-2024.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 10.  [–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂](/practice/pr-10-2024.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 11.  [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π SQL](/practice/pr-11.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 12.  [–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ Joins](/practice/pr-12.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 13.  [–ü–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞](/practice/pr-13.pdf).
  - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 14.  [–§—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã](/practice/pr-14.pdf).

## –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ `1`. [–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞–Ω–∏—è]().

–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ `2`. [–†–æ–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏](). –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –≤ –≤–∏–¥–µ:
  
- –æ—Ç—á–µ—Ç(—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è 1-2);
   
- —Ñ–∞–π–ª —Å —Ä–µ—à–µ–Ω–∏–µ–º –∑–∞–¥–∞–Ω–∏—è 3-5 –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.ipynb`;
    
- –¥–∞–º–ø —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `sql`.

–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ `3`. [–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞–Ω–∏—è]()

–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ `4`. [–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞–Ω–∏—è]()

## –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä

üìó[–£—Ä–æ–≤–µ–Ω—å 1Ô∏è‚É£:](/Module1/README.md)

‚ùì[–£—Ä–æ–≤–µ–Ω—å 1. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 1](/Module1/PracticeModule1/README.md)

üìó[–£—Ä–æ–≤–µ–Ω—å 2Ô∏è‚É£:](/Module2/README.md)

‚ùì[–£—Ä–æ–≤–µ–Ω—å 2. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 2](/main/Module2/PracticeModule2/README.md)

üìó[–£—Ä–æ–≤–µ–Ω—å 3Ô∏è‚É£:]()

‚ùì[–£—Ä–æ–≤–µ–Ω—å 3. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 3]


## –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω

[–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è 2024](https://github.com/BosenkoTM/SQL-for-Begginer-Data-Analytics/blob/main/practice/examp24case.pdf)

## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã

1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö. –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –ø–æ–º–æ—â—å—é `JOIN`. –¢–∏–ø—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã. Union.
2. –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö. –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. `GROUP BY` –≤ –ê-—Ñ—É–Ω–∫—Ü–∏—è—Ö.
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∏—Å–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é `GROUP BY`.
5. –ò–∑–º–µ—Ä–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.
6. –û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö. –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –æ–∫–æ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏. 
7. –ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö. –ö–æ–º–∞–Ω–¥–∞ `COPY`.
8. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `R` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
9. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Python` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. `SQLAlchemy 2.0`. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Python —Å –Ω–æ—É—Ç–±—É–∫–∞–º–∏ `Jupyter`. –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é `Pandas`. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é `Pandas`.
10. –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é `Python`. –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ `Python` —Å –ø–æ–º–æ—â—å—é `COPY`. –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ `CSV` —Å –ø–æ–º–æ—â—å—é `Python`.
11. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –¢–∏–ø—ã –¥–∞—Ç. –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã.
12. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤ `Postgres`. –®–∏—Ä–æ—Ç–∞ –∏ –¥–æ–ª–≥–æ—Ç–∞. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —à–∏—Ä–æ—Ç—ã –∏ –¥–æ–ª–≥–æ—Ç—ã –≤ `Postgres`.
13. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤–∞ –≤ `Postgres`.
14. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö `JSON` –≤ Postgres `JSONB`: –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π `JSON`. –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∏–∑ –ø–æ–ª—è `JSON` –∏–ª–∏ `JSONB`. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–ª–µ `JSONB`.
15. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π `SQL`. –ú–µ—Ç–æ–¥—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞. –ò–Ω–¥–µ–∫—Å B-–¥–µ—Ä–µ–≤–∞. –•—ç—à-–∏–Ω–¥–µ–∫—Å.
16. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
17. –§—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
18. –¢—Ä–∏–≥–≥–µ—Ä—ã. –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤.

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1. –ê–Ω–∞–ª–∏–∑ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ü—Ä–æ–¥–∞–∂ –ø–æ –†–µ–≥–∏–æ–Ω–∞–º –∏ –ü—Ä–æ–¥—É–∫—Ç–∞–º

*   **–¶–µ–ª—å:** –≤—ã—è–≤–∏—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ –∏ –Ω–∞–∏–º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã (—à—Ç–∞—Ç—ã) —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –æ–±—â–µ–π —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≥–æ–¥. –î–ª—è —Ç–æ–ø-3 —Ä–µ–≥–∏–æ–Ω–æ–≤ –ø–æ —Å—É–º–º–µ –ø—Ä–æ–¥–∞–∂, –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –ø–æ —Ç–∏–ø–∞–º –ø—Ä–æ–¥—É–∫—Ç–æ–≤.
*   **–¢–∞–±–ª–∏—Ü—ã:** `sales`, `products`, `customers` (–¥–ª—è –∞–¥—Ä–µ—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ–¥–∞–∂), `dealerships` (–¥–ª—è –∞–¥—Ä–µ—Å–∞ –¥–∏–ª–µ—Ä—Å–∫–∏—Ö –ø—Ä–æ–¥–∞–∂).
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–ª–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≥–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è 2024, —Ç–æ –∑–∞ 2023 –≥–æ–¥).
    2.  –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —à—Ç–∞—Ç –ø—Ä–æ–¥–∞–∂–∏: –¥–ª—è `channel = 'dealership'` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à—Ç–∞—Ç –∏–∑ `dealerships`, –¥–ª—è `channel = 'internet'` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à—Ç–∞—Ç –∏–∑ `customers`. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `COALESCE` –∏ `LEFT JOIN`.
    3.  –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –ø–æ —à—Ç–∞—Ç–∞–º. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—â—É—é —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`transaction_id`) –∏ —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ (–æ–±—â–∞—è —Å—É–º–º–∞ / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à—Ç–∞—Ç–∞.
    4.  –ò—Å–ø–æ–ª—å–∑—É—è –æ–∫–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `RANK()`, –ø—Ä–∏—Å–≤–æ–∏—Ç—å —Ä–∞–Ω–≥ —à—Ç–∞—Ç–∞–º –ø–æ –æ–±—â–µ–π —Å—É–º–º–µ –ø—Ä–æ–¥–∞–∂.
    5.  –°–æ–∑–¥–∞—Ç—å CTE –¥–ª—è —Ç–æ–ø-3 —à—Ç–∞—Ç–æ–≤.
    6.  –î–ª—è —ç—Ç–∏—Ö —Ç–æ–ø-3 —à—Ç–∞—Ç–æ–≤, –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å `products` –∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ `product_type`, —Ä–∞—Å—Å—á–∏—Ç–∞–≤ —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂.
    7.  –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —Å–Ω–∞—á–∞–ª–∞ –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º —à—Ç–∞—Ç–∞–º, –∑–∞—Ç–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º –¥–ª—è —Ç–æ–ø-3 —à—Ç–∞—Ç–æ–≤ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `UNION ALL` —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º —Ç–∏–ø–∞ —Å—Ç—Ä–æ–∫–∏).

### –ó–∞–¥–∞–Ω–∏–µ 2. RFM-—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ö–ª–∏–µ–Ω—Ç–æ–≤

*   **–¶–µ–ª—å:** —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–≤–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏ (Recency), —á–∞—Å—Ç–æ—Ç—ã –ø–æ–∫—É–ø–æ–∫ (Frequency) –∏ –æ–±—â–µ–π —Å—É–º–º—ã –ø–æ–∫—É–ø–æ–∫ (Monetary).
*   **–¢–∞–±–ª–∏—Ü—ã:** `customers`, `sales`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å:
        *   **Recency**: –î–∞–≤–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏ (–≤ –¥–Ω—è—Ö –æ—Ç `CURRENT_DATE` –¥–æ `MAX(sale_date)`).
        *   **Frequency**: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`COUNT(DISTINCT transaction_id)`).
        *   **Monetary**: –û–±—â—É—é —Å—É–º–º—É –≤—Å–µ—Ö –µ–≥–æ –ø–æ–∫—É–ø–æ–∫ (`SUM(sale_amount)`).
    2.  –ò—Å–ø–æ–ª—å–∑—É—è `NTILE(4)` –∏–ª–∏ `NTILE(5)` –ø–æ –∫–∞–∂–¥–æ–º—É –∏–∑ R, F, M –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ), –ø—Ä–∏—Å–≤–æ–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º R-–±–∞–ª–ª, F-–±–∞–ª–ª –∏ M-–±–∞–ª–ª. (–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è Recency - —á–µ–º –º–µ–Ω—å—à–µ –¥–Ω–µ–π, —Ç–µ–º –≤—ã—à–µ –±–∞–ª–ª).
    3.  –í—ã–≤–µ—Å—Ç–∏ `customer_id`, R-–±–∞–ª–ª, F-–±–∞–ª–ª, M-–±–∞–ª–ª.
    4.  *–ë–æ–Ω—É—Å:* –°–æ–∑–¥–∞—Ç—å —Å—Ç–æ–ª–±–µ—Ü `Segment` –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–µ–π –±–∞–ª–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'R5_F5_M5' - –ª—É—á—à–∏–µ –∫–ª–∏–µ–Ω—Ç—ã).

### –ó–∞–¥–∞–Ω–∏–µ 3. –ê–Ω–∞–ª–∏–∑ –î–∏–Ω–∞–º–∏–∫–∏ –°—Ä–µ–¥–Ω–µ–π –¶–µ–Ω—ã –ü—Ä–æ–¥—É–∫—Ç–∞ –∏ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å MSRP

*   **–¶–µ–ª—å:** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –µ–∂–µ–º–µ—Å—è—á–Ω—É—é —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏ –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å –µ–µ —Å `base_msrp`. –í—ã—è–≤–∏—Ç—å –º–µ—Å—è—Ü—ã, –∫–æ–≥–¥–∞ –ø—Ä–æ–¥—É–∫—Ç –ø—Ä–æ–¥–∞–≤–∞–ª—Å—è —Å–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ–º –æ—Ç MSRP.
*   **–¢–∞–±–ª–∏—Ü—ã:** `sales`, `products`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –ø–æ `product_id` –∏ –º–µ—Å—è—Ü—É (`DATE_TRUNC('month', sale_date)`).
    2.  –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏ –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã (`SUM(sale_amount) / SUM(quantity_sold)`).
    3.  –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å `base_msrp` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `products`.
    4.  –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –ø—Ä–æ–¥–∞–∂–∏ –æ—Ç `base_msrp` –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö: `((avg_sale_price - base_msrp) / base_msrp) * 100`.
    5.  –ò—Å–ø–æ–ª—å–∑—É—è `CASE WHEN`, –ø–æ–º–µ—Ç–∏—Ç—å —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ > +10% (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞) –∏–ª–∏ < -15% (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞).

### –ó–∞–¥–∞–Ω–∏–µ 4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–£—Å–Ω—É–≤—à–∏—Ö" –ö–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏

*   **–¶–µ–ª—å:** –Ω–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤, –Ω–µ —Å–æ–≤–µ—Ä—à–∞–≤—à–∏—Ö –ø–æ–∫—É–ø–æ–∫ –±–æ–ª–µ–µ 180 –¥–Ω–µ–π, –Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–≤—à–∏—Ö –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ email-—Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –¥–Ω–µ–π.
*   **–¢–∞–±–ª–∏—Ü—ã:** `customers`, `sales`, `emails_log`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –°–æ–∑–¥–∞—Ç—å CTE `last_purchase_date` —Å `customer_id` –∏ –¥–∞—Ç–æ–π –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏ (`MAX(sale_date)`).
    2.  –°–æ–∑–¥–∞—Ç—å CTE `last_email_open_date` —Å `customer_id` –∏ –¥–∞—Ç–æ–π –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è email (`MAX(opened_date)`).
    3.  `LEFT JOIN` `customers` —Å `last_purchase_date` –∏ `last_email_open_date`.
    4.  –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö:
        *   –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–∫—É–ø–∫–∞ –±—ã–ª–∞ > 180 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç `CURRENT_DATE` (–∏–ª–∏ `COALESCE(last_purchase_date, '1900-01-01')`).
        *   –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ email –±—ã–ª–æ < 60 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç `CURRENT_DATE` –∏ `opened_date IS NOT NULL`.
    5.  –í—ã–≤–µ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö (–∏–º—è, email, –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏, –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è email).

### –ó–∞–¥–∞–Ω–∏–µ 5. –†–∞—Å—á–µ—Ç 30-–¥–Ω–µ–≤–Ω–æ–≥–æ –°–∫–æ–ª—å–∑—è—â–µ–≥–æ –°—Ä–µ–¥–Ω–µ–≥–æ –û–±—ä–µ–º–∞ –ü—Ä–æ–¥–∞–∂ –ø–æ –ö–∞–∂–¥–æ–º—É –ö–∞–Ω–∞–ª—É

*   **–¶–µ–ª—å:** –æ—Ç—Å–ª–µ–¥–∏—Ç—å —Ç—Ä–µ–Ω–¥—ã –ø—Ä–æ–¥–∞–∂ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ ('internet', 'dealership'), –∏—Å–ø–æ–ª—å–∑—É—è 30-–¥–Ω–µ–≤–Ω–æ–µ —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂.
*   **–¢–∞–±–ª–∏—Ü—ã:** `sales`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –°–æ–∑–¥–∞—Ç—å CTE, –∞–≥—Ä–µ–≥–∏—Ä—É—é—â—É—é –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ–±—â–∏–µ —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂ (`SUM(sale_amount)`) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ (`channel`) –∏ –∫–∞–∂–¥–æ–π –¥–∞—Ç—ã (`DATE_TRUNC('day', sale_date)`).
    2.  –ò—Å–ø–æ–ª—å–∑—É—è –æ–∫–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `AVG(daily_total_sales) OVER (PARTITION BY channel ORDER BY sale_day ROWS BETWEEN 29 PRECEDING AND CURRENT ROW)`, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å 30-–¥–Ω–µ–≤–Ω–æ–µ —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ.
    3.  –í—ã–≤–µ—Å—Ç–∏ –¥–∞—Ç—É, –∫–∞–Ω–∞–ª, —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂ –∑–∞ –¥–µ–Ω—å –∏ 30-–¥–Ω–µ–≤–Ω–æ–µ —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ.

### –ó–∞–¥–∞–Ω–∏–µ 6. –ê–Ω–∞–ª–∏–∑ –ü—Ä–æ–¥–∞–≤—Ü–æ–≤: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –°—Ç–∞–∂

*   **–¶–µ–ª—å:** –æ—Ü–µ–Ω–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –ø–æ –æ–±—â–µ–π —Å—É–º–º–µ –ø—Ä–æ–¥–∞–∂, —Å—Ä–µ–¥–Ω–µ–º—É —á–µ–∫—É –∏—Ö –ø—Ä–æ–¥–∞–∂, –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ –∏—Ö —Ç–µ–∫—É—â–µ–º—É —Å—Ç–∞–∂—É —Ä–∞–±–æ—Ç—ã.
*   **–¢–∞–±–ª–∏—Ü—ã:** `salespeople`, `sales`, `products`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ (`termination_date IS NULL`).
    2.  –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–≤—Ü–∞ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å:
        *   –û–±—â—É—é —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂ (`SUM(s.sale_amount)`).
        *   –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –ø–æ –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º (`AVG(transaction_total_amount)` - –ø–æ—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂ –ø–æ `transaction_id`).
        *   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö `product_id`, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –ø—Ä–æ–¥–∞–ª (`COUNT(DISTINCT s.product_id)`).
        *   –°—Ç–∞–∂ —Ä–∞–±–æ—Ç—ã –≤ –ø–æ–ª–Ω—ã—Ö –º–µ—Å—è—Ü–∞—Ö (–æ—Ç `hire_date` –¥–æ `CURRENT_DATE`).
    3.  –ü—Ä–∏—Å–≤–æ–∏—Ç—å —Ä–∞–Ω–≥ –ø—Ä–æ–¥–∞–≤—Ü–∞–º –ø–æ –æ–±—â–µ–π —Å—É–º–º–µ –ø—Ä–æ–¥–∞–∂.
    4.  –í—ã–≤–µ—Å—Ç–∏ –§–ò–û –ø—Ä–æ–¥–∞–≤—Ü–∞, —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂, —Ä–∞–Ω–≥, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫, –∫–æ–ª-–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤, —Å—Ç–∞–∂.

### –ó–∞–¥–∞–Ω–∏–µ 7. –ì–µ–æ–∞–Ω–∞–ª–∏–∑: –°—Ä–µ–¥–Ω–µ–µ –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ö–ª–∏–µ–Ω—Ç–æ–≤ –¥–æ –ë–ª–∏–∂–∞–π—à–µ–≥–æ –î–∏–ª–µ—Ä—Å–∫–æ–≥–æ –¶–µ–Ω—Ç—Ä–∞ –ø–æ –®—Ç–∞—Ç–∞–º

*   **–¶–µ–ª—å:** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à—Ç–∞—Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –µ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç—ã, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —ç—Ç–æ–≥–æ —à—Ç–∞—Ç–∞ –¥–æ –∏—Ö –±–ª–∏–∂–∞–π—à–µ–≥–æ –¥–∏–ª–µ—Ä—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞. –£—á–∏—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.
*   **–¢–∞–±–ª–∏—Ü—ã:** `customers`, `dealerships`. (–ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `cube` –∏ `earthdistance` –≤ PostgreSQL).
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –°–æ–∑–¥–∞—Ç—å CTE `customer_locations` —Å `customer_id`, `state` –∏ `ll_to_earth(latitude, longitude)` –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏.
    2.  –°–æ–∑–¥–∞—Ç—å CTE `dealership_locations` —Å `dealership_id` –∏ `ll_to_earth(latitude, longitude)` –¥–ª—è –¥–∏–ª–µ—Ä—Å–∫–∏—Ö —Ü–µ–Ω—Ç—Ä–æ–≤.
    3.  –ò—Å–ø–æ–ª—å–∑—É—è `CROSS JOIN` –º–µ–∂–¥—É `customer_locations` –∏ `dealership_locations`, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (`earth_distance(cl.customer_point, dl.dealership_point)`).
    4.  –° –ø–æ–º–æ—â—å—é –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `ROW_NUMBER() OVER (PARTITION BY cl.customer_id ORDER BY distance ASC)` –Ω–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–∏–π –¥–∏–ª–µ—Ä—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.
    5.  –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –±–ª–∏–∂–∞–π—à–∏–µ (`row_num = 1`).
    6.  –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ `cl.state` –∏ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å `AVG(distance)` –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –¥–∏–ª–µ—Ä—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞ (–ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –º–µ—Ç—Ä—ã –≤ –∫–∏–ª–æ–º–µ—Ç—Ä—ã –∏–ª–∏ –º–∏–ª–∏).

### –ó–∞–¥–∞–Ω–∏–µ 8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –§—É–Ω–∫—Ü–∏—è –¥–ª—è –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ö–ª–∏–µ–Ω—Ç–∞

*   **–¶–µ–ª—å:** –Ω–∞–ø–∏—Å–∞—Ç—å SQL-—Ñ—É–Ω–∫—Ü–∏—é `get_customer_category(customer_id_param INT)`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–ª–∏–µ–Ω—Ç–∞ ('VIP', 'Regular', 'New') –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫.
*   **–¢–∞–±–ª–∏—Ü—ã:** `customers`, `sales`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏ (–≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏):**
    1.  –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—â—É—é —Å—É–º–º—É –ø–æ–∫—É–ø–æ–∫ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
    2.  –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
        *   –ï—Å–ª–∏ –æ–±—â–∞—è —Å—É–º–º–∞ > $5000 –ò –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π > 10, —Ç–æ 'VIP'.
        *   –ï—Å–ª–∏ –æ–±—â–∞—è —Å—É–º–º–∞ > $500 –ò (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π > 1 –ò–õ–ò –ø—Ä–æ—à–ª–æ < 90 –¥–Ω–µ–π —Å `date_added`), —Ç–æ 'Regular'.
        *   –ò–Ω–∞—á–µ 'New'.
    3.  –§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `TEXT`.
    4.  –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –≤—ã–∑–≤–∞–≤ –µ–µ –≤ `SELECT` –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö `customer_id`.
        ```sql
        SELECT customer_id, get_customer_category(customer_id) FROM customers LIMIT 10;
        ```

### –ó–∞–¥–∞–Ω–∏–µ 9. –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –î–∞—Ç—ã –ü–æ—Å–ª–µ–¥–Ω–µ–π –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ö–ª–∏–µ–Ω—Ç–∞

*   **–¶–µ–ª—å:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–æ–ª–µ `last_activity_date` –≤ —Ç–∞–±–ª–∏—Ü–µ `customers` –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ `sales` –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `opened_date` –≤ `emails_log`.
*   **–¢–∞–±–ª–∏—Ü—ã:** `customers` (—Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º –ø–æ–ª–µ–º `last_activity_date TIMESTAMP`), `sales`, `emails_log`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü `last_activity_date TIMESTAMP` –≤ —Ç–∞–±–ª–∏—Ü—É `customers`, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç.
    2.  –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `update_customer_last_activity()`, –∫–æ—Ç–æ—Ä–∞—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `last_activity_date = CURRENT_TIMESTAMP` –¥–ª—è —Å—Ç—Ä–æ–∫–∏ –≤ `customers`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π `NEW.customer_id` (–¥–ª—è `sales`) –∏–ª–∏ `NEW.customer_id` (–¥–ª—è `emails_log`).
    3.  –°–æ–∑–¥–∞—Ç—å –¥–≤–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞:
        *   `trg_sales_update_activity`: —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `AFTER INSERT` –Ω–∞ `sales` `FOR EACH ROW` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `update_customer_last_activity()`.
        *   `trg_email_open_update_activity`: —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `AFTER UPDATE OF opened_date` –Ω–∞ `emails_log` `FOR EACH ROW` `WHEN (NEW.opened_date IS NOT NULL AND OLD.opened_date IS NULL)` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `update_customer_last_activity()`.

### –ó–∞–¥–∞–Ω–∏–µ 10. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ï–∂–µ–º–µ—Å—è—á–Ω–æ–≥–æ –ü—Ä–∏—Ä–æ—Å—Ç–∞ –ù–æ–≤—ã—Ö –ö–ª–∏–µ–Ω—Ç–æ–≤ –∏ –°—É–º–º—ã –ü—Ä–æ–¥–∞–∂ –ø–æ –ö–∞–Ω–∞–ª–∞–º

*   **–¶–µ–ª—å:** –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å —Ä–æ—Å—Ç–æ–º –ø—Ä–æ–¥–∞–∂ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞.
*   **–¢–∞–±–ª–∏—Ü—ã:** `customers`, `sales`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  CTE `monthly_new_customers`: –ï–∂–µ–º–µ—Å—è—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (`DATE_TRUNC('month', date_added)`).
    2.  CTE `monthly_sales_by_channel`: –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ (`SUM(sale_amount)`) –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`COUNT(DISTINCT transaction_id)`) –ø–æ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É (`channel`) –∏ –º–µ—Å—è—Ü—É (`DATE_TRUNC('month', sale_date)`).
    3.  –û–±—ä–µ–¥–∏–Ω–∏—Ç—å CTE –ø–æ –º–µ—Å—è—Ü—É.
    4.  –ò—Å–ø–æ–ª—å–∑—É—è –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `LAG()`, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –¥–ª—è:
        *   –ù–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ).
        *   –°—É–º–º—ã –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É.
        *   –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É.
    5.  –í—ã–≤–µ—Å—Ç–∏ –º–µ—Å—è—Ü, –∫–∞–Ω–∞–ª, –∫–æ–ª-–≤–æ –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL –¥–ª—è —Å—Ç—Ä–æ–∫ –∫–∞–Ω–∞–ª–æ–≤, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å), —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂, –∫–æ–ª-–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –∏—Ö –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –ø—Ä–∏—Ä–æ—Å—Ç—ã.

### –ó–∞–¥–∞–Ω–∏–µ 11. –ê–Ω–∞–ª–∏–∑ "–ö–æ—Ä–∑–∏–Ω—ã": –¢–æ–ø-3 –ü–∞—Ä—ã –ü—Ä–æ–¥—É–∫—Ç–æ–≤, –ü–æ–∫—É–ø–∞–µ–º—ã—Ö –í–º–µ—Å—Ç–µ

*   **–¶–µ–ª—å:** –Ω–∞–π—Ç–∏ —Ç–æ–ø-3 –ø–∞—Ä—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–∫—É–ø–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
*   **–¢–∞–±–ª–∏—Ü—ã:** `sales` (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –ø–æ–ª–µ `transaction_id` –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –æ–¥–Ω–æ–π –ø–æ–∫—É–ø–∫–∏).
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –í—ã–ø–æ–ª–Ω–∏—Ç—å `SELF JOIN` —Ç–∞–±–ª–∏—Ü—ã `sales` (–∞–ª–∏–∞—Å—ã `s1` –∏ `s2`) –ø–æ `s1.transaction_id = s2.transaction_id`.
    2.  –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ `s1.product_id < s2.product_id`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä (A,B) –∏ (B,A) –∏ —Å–∞–º–æ-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (A,A).
    3.  –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø–∞—Ä–µ `(s1.product_id, s2.product_id)`.
    4.  –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–∫–∏—Ö —Å–æ–≤–º–µ—Å—Ç–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫ `COUNT(*) AS pair_count`.
    5.  –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ `pair_count` –ø–æ —É–±—ã–≤–∞–Ω–∏—é –∏ –≤–∑—è—Ç—å `LIMIT 3`.
    6.  –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ `products` –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏.

### –ó–∞–¥–∞–Ω–∏–µ 12. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ó–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ü–æ–∏—Å–∫ –ö–ª–∏–µ–Ω—Ç–æ–≤ —Å –§–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π

*   **–¶–µ–ª—å:** –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å.
    ```sql
    -- –ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    SELECT 
        customer_id, 
        first_name, 
        last_name, 
        email,
        (SELECT COUNT(*) FROM sales s WHERE s.customer_id = c.customer_id) as total_orders
    FROM customers c
    WHERE 
        c.state = 'CA' 
        AND lower(c.last_name) LIKE 'smi%'
    ORDER BY 
        date_added DESC
    LIMIT 50;
    ```
*   **–¢–∞–±–ª–∏—Ü—ã:** `customers`, `sales`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `EXPLAIN ANALYZE` –¥–ª—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
    2.  –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏—è:
        *   –ó–∞–º–µ–Ω–∏—Ç—å –ø–æ–¥–∑–∞–ø—Ä–æ—Å –≤ `SELECT` –Ω–∞ `LEFT JOIN` —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π `sales` (—Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ `customer_id` –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∑–∞–∫–∞–∑–æ–≤).
        *   –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `customers(state, date_added)`.
        *   –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `customers(lower(last_name) text_pattern_ops)` –¥–ª—è `LIKE 'smi%'`.
        *   –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `sales(customer_id)`.
    3.  –ù–∞–ø–∏—Å–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –∑–∞–ø—Ä–æ—Å–∞.
    4.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `EXPLAIN ANALYZE` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å –ø–ª–∞–Ω—ã/–≤—Ä–µ–º—è.

### –ó–∞–¥–∞–Ω–∏–µ 13. –í—ã—è–≤–ª–µ–Ω–∏–µ –ê–Ω–æ–º–∞–ª—å–Ω—ã—Ö –ü—Ä–æ–¥–∞–∂ –ø–æ –°—É–º–º–µ –¥–ª—è –ö–∞–∂–¥–æ–≥–æ –¢–∏–ø–∞ –ü—Ä–æ–¥—É–∫—Ç–∞

*   **–¶–µ–ª—å:** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–∞–π—Ç–∏ –ø—Ä–æ–¥–∞–∂–∏, —Å—É–º–º–∞ –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã –∫–æ—Ç–æ—Ä—ã—Ö (`sale_amount / quantity_sold`) –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 2.5 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è) –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –ø—Ä–æ–¥–∞–∂–∏ –µ–¥–∏–Ω–∏—Ü—ã —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–¥—É–∫—Ç–∞.
*   **–¢–∞–±–ª–∏—Ü—ã:** `sales`, `products`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ü–µ–Ω—É –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ `sales`: `price_per_unit = sale_amount / quantity_sold`.
    2.  CTE `product_type_stats`: –î–ª—è –∫–∞–∂–¥–æ–≥–æ `product_type` —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å `AVG(price_per_unit)` –∏ `STDDEV(price_per_unit)`.
    3.  –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å `product_type_stats` –∫ –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–µ (—Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–π `price_per_unit`).
    4.  –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏, –≥–¥–µ `price_per_unit > avg_ppu + 2.5 * stddev_ppu` –ò–õ–ò `price_per_unit < avg_ppu - 2.5 * stddev_ppu`.
    5.  –í—ã–≤–µ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥–∞–∂–µ (`sale_id`, `product_name`, `product_type`, `price_per_unit`), –∞ —Ç–∞–∫–∂–µ `avg_ppu` –∏ `stddev_ppu` –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–¥—É–∫—Ç–∞, –∏ –≤–µ–ª–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è.

### –ó–∞–¥–∞–Ω–∏–µ 14. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `DISTINCT ON` –¥–ª—è –ü–æ–ª—É—á–µ–Ω–∏—è –°–∞–º–æ–≥–æ –î–æ—Ä–æ–≥–æ–≥–æ –ü—Ä–æ–¥—É–∫—Ç–∞ –≤ –ö–∞–∂–¥–æ–π –ü—Ä–æ–¥–∞–∂–µ (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

*   **–¶–µ–ª—å:** –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`transaction_id`) –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∞–º–æ–º –¥–æ—Ä–æ–≥–æ–º –ø—Ä–æ–¥–∞–Ω–Ω–æ–º –ø—Ä–æ–¥—É–∫—Ç–µ (–ø–æ `sale_amount`).
*   **–¢–∞–±–ª–∏—Ü—ã:** `sales`, `products`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SELECT DISTINCT ON (s.transaction_id) ...`
    2.  `ORDER BY s.transaction_id, s.sale_amount DESC`.
    3.  –í—ã–±—Ä–∞—Ç—å `s.transaction_id`, `s.product_id`, `p.product_name`, `s.sale_amount`.
    4.  –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `products` (–∞–ª–∏–∞—Å `p`) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `product_name`.

### –ó–∞–¥–∞–Ω–∏–µ 15. –°–≤–æ–¥–Ω—ã–π –û—Ç—á–µ—Ç –ø–æ –ü—Ä–æ–¥–∞–∂–∞–º —Å –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `GROUPING SETS`

*   **–¶–µ–ª—å:** —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –æ–±—â—É—é —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂ (`SUM(sale_amount)`) –∏ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü (`SUM(quantity_sold)`) –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ä–∞–∑—Ä–µ–∑–∞—Ö:
    *   –ü–æ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É (`channel`).
    *   –ü–æ –∫–∞–∂–¥–æ–º—É —Ç–∏–ø—É –ø—Ä–æ–¥—É–∫—Ç–∞ (`product_type`).
    *   –ü–æ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É –∏ —Ç–∏–ø—É –ø—Ä–æ–¥—É–∫—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
    *   –û–±—â–∏–π –∏—Ç–æ–≥ –ø–æ –≤—Å–µ–º –ø—Ä–æ–¥–∞–∂–∞–º.
*   **–¢–∞–±–ª–∏—Ü—ã:** `sales`, `products`.
*   **–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
    1.  –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã `sales` –∏ `products`.
    2.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `GROUP BY GROUPING SETS` –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ `SUM(s.sale_amount)` –∏ `SUM(s.quantity_sold)` –ø–æ:
        *   `(s.channel)`
        *   `(p.product_type)`
        *   `(s.channel, p.product_type)`
        *   `()` (–æ–±—â–∏–π –∏—Ç–æ–≥)
    3.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `COALESCE(s.channel, '–í—Å–µ –∫–∞–Ω–∞–ª—ã') AS report_channel` –∏ `COALESCE(p.product_type, '–í—Å–µ —Ç–∏–ø—ã') AS report_product_type` –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ –≤ –æ—Ç—á–µ—Ç–µ.
    4.  –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ `report_channel`, `report_product_type`).

## –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞
1. –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è —Å SQL. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö.(–∞–Ω–≥–ª) [—Ä–µ—Å—É—Ä—Å](https://disk.yandex.ru/i/_2b5-Ta8Il6MbQ)
2. –ë–æ—Å–µ–Ω–∫–æ , –¢.–ú. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤: –£—á–µ–±–Ω–æ-–º–µ—Ç–æ–¥–∏—á–µ—Å–∫–æ–µ –ø–æ—Å–æ–±–∏–µ. ‚Äì–ú–æ—Å–∫–≤–∞: –û–±—â–µ—Å—Ç–≤–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é "–≠–¥–∏—Ç—É—Å", 2023. ‚Äì56 —Å. ‚Äì ISBN 978-5-00217-072-2.

3. –ì—Ä–æ—Ñ—Ñ, –î–∂. SQL. –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ. 2014. ‚Äì 960 c. [—Ä–µ—Å—É—Ä—Å](https://disk.yandex.ru/i/-NmQh9Z3kktBWQ) 

4. –ú–æ—Ä–≥—É–Ω–æ–≤, –ï. –ü. –Ø–∑—ã–∫ SQL. –ë–∞–∑–æ–≤—ã–π –∫—É—Ä—Å : —É—á–µ–±.-–ø—Ä–∞–∫—Ç. –ø–æ—Å–æ–±–∏–µ / –ü–æ–¥ —Ä–µ–¥. –ï. –í. –†–æ–≥–æ–≤–∞, –ü. –í. –õ—É–∑–∞–Ω–æ–≤–∞; Postgres Professional. ‚Äì –ú., 2017. ‚Äì 257 —Å. [—Ä–µ—Å—É—Ä—Å](https://postgrespro.ru/education/books/sqlprimer) 
 
5. –õ—É–∑–∞–Ω–æ–≤, –ü. PostgreSQL –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö / –ü. –õ—É–∑–∞–Ω–æ–≤, –ï. –†–æ–≥–æ–≤, –ò. –õ—ë–≤—à–∏–Ω ; Postgres Professional. ‚Äì –ú., 2017. ‚Äì 146 —Å. [—Ä–µ—Å—É—Ä—Å](https://postgrespro.ru/media/2018/01/10/introbook_v4.pdf)
    
## –î–∞–Ω–Ω—ã–µ 

[Datasets for lessons](https://disk.yandex.ru/d/p3ga3WZpmAw8-Q)
